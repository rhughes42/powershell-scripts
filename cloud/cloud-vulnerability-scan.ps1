<#
.SYNOPSIS
    Scan cloud resources for vulnerabilities using native tools.
.DESCRIPTION
    Uses CLI tools to check for known vulnerabilities in VMs, containers, and storage, exports to CSV.
.PARAMETER Provider
    Cloud provider: Azure, AWS, or GCP.
.PARAMETER OutputCsv
    Path to export results.
#>
param(
    [ValidateSet('Azure', 'AWS', 'GCP')][string]$Provider,
    [string]$OutputCsv = 'CloudVulnerabilityScan.csv'
)

switch ($Provider) {
    'Azure' {
        $findings = az security assessment list | ConvertFrom-Json
        $results = $findings | Select-Object displayName, status, resourceDetails, remediation
    }
    'AWS' {
        $findings = aws inspector2 list-findings | ConvertFrom-Json
        $results = $findings.findings | Select-Object title, severity, resourceType, description
    }
    'GCP' {
        $findings = gcloud container vulnerabilities list --format=json | ConvertFrom-Json
        $results = $findings | Select-Object name, severity, description
    }
}
$results | Format-Table -AutoSize
$results | Export-Csv -Path $OutputCsv -NoTypeInformation
